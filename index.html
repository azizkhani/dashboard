<!DOCTYPE HTML>
<meta name="viewport" content="width=device-width">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,600" rel="stylesheet">
<style>
    html {
        text-align: right;
        font-family: 'Open Sans', sans-serif;
        font-size: 8vmin;
        font-style: normal;
        font-weight: 300;
        color: white;
        background: black;
        -webkit-font-smoothing: subpixel-antialiased;
    }
    #dayOfMonthOrdinal {
        font-size: 4vmin;
        vertical-align: super;
    }
    #timeColon {
        vertical-align: 1vmin;
    }
    .date {
        font-size: 6vmin;
    }
    .time {
        font-weight: 600;
        font-size: 26vmin;
        margin-top: -3vmin;
    }
    .weather {
        display: inline-block;
        position: relative;
        text-align: center;
    }
    #wunderground {
        /* The Wunderground API requires an attribution image. */
        /* https://www.wunderground.com/weather/api/d/terms.html */
        position: absolute;
        width: 90px;
        left: 0;
        bottom: 0;
        margin: 10px;
    }
    .forecast {
        font-size: 10vmin;
        /* Leave space for icons. */
        padding-left: 24vmin;
        min-height: 22vmin;
    }
    .weather .forecast:not(:first-child) {
        margin-top: 4vmin;
    }
    .forecastIcon {
        width: 22vmin;
        height: 22vmin;
        position: absolute;
        left: 0;
    }
    .forecastHigh {
        font-weight: 600;
        vertical-align: super;
    }
    .forecastHighLowSeparater {
    }
    .forecastLow {
        vertical-align: sub;
    }
    .forecastConditions {
        font-size: 4vmin;
    }
</style>
<div class="date">
    <span id="day">Saturday</span>, <span id="month">Sep</span> <span id="dayOfMonth">10</span><span id="dayOfMonthOrdinal">st</span>
</div>
<div class="time">
    <span id="hour">5</span><span id="timeColon">:</span><span id="minute">21</span>
</div>
<div class="weather">
    <div id="today" class="forecast">
        <img class="forecastIcon">
        <span class="forecastHigh"><span class="forecastHighTemp">212</span>&deg;</span><span class="forecastHighLowSeparater">/</span><span class="forecastLow"><span class="forecastLowTemp">32</span>&deg;</span>
        <div class="forecastConditions">Saturday: Thunderstorms</div>
    </div>
    <div id="tomorrow" class="forecast">
        <img class="forecastIcon">
        <span class="forecastHigh"><span class="forecastHighTemp">212</span>&deg;</span><span class="forecastHighLowSeparater">/</span><span class="forecastLow"><span class="forecastLowTemp">32</span>&deg;</span>
        <div class="forecastConditions">Saturday: Thunderstorms</div>
    </div>
</div>
<img id="wunderground" src="wundergroundLogo.png">
<script>
    var weekdays = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    function dayOfWeekName(date) {
        return weekdays[date.getDay()];
    }

    var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec'];
    function monthName(date) {
        return months[date.getMonth()];
    }

    // Return the English ordinal for a number.
    function ordinal(number) {
        // The general ordinal pattern in English:
        //   number ends in 1 -> st (e.g., 31st)
        //   number ends in 2 -> nd (e.g., 32nd)
        //   number ends in 3 -> rd (e.g., 33rd)
        // 11, 12, and 13 are exceptions and just use 'th'.
        switch(number % 10) {
            case(1): if (number == 11) { break; } else { return 'st' };
            case(2): if (number == 12) { break; } else { return 'nd' };
            case(3): if (number == 13) { break; } else { return 'rd' };
        }
        return 'th';
    }

    function updateDateTime() {
        var date = new Date();

        day.innerText = dayOfWeekName(date);
        month.innerText = monthName(date);
        dayOfMonth.innerText = date.getDate();
        dayOfMonthOrdinal.innerText = ordinal(date.getDate());

        hour.innerText = date.getHours();
        // Make the colon white on even seconds, black on odd seconds.
        var colonVisible = date.getSeconds() % 2 === 0;
        timeColon.style.color = colonVisible ? 'white' : 'black';
        minute.innerText = (date.getMinutes() < 10 ? '0' : '') + date.getMinutes();
    }

    function getForecast(useCelsius, callback) {
        // API key from https://www.wunderground.com/weather/api
        var apiKey = '18dc12c420cff7c6';
        var forecastUrl = 'https://api.wunderground.com/api/' + apiKey + '/forecast/q/autoip.json';
        var forecastRequest = new Request(forecastUrl);
        fetch(forecastRequest)
            .then(function(response) {
                return response.json();
            }).then(function(json) {
                var today = json.forecast.simpleforecast.forecastday[0];
                var tomorrow = json.forecast.simpleforecast.forecastday[1];
                callback({
                    today: {
                        day: today.date.weekday,
                        conditions: today.conditions,
                        high: useCelsius ? today.high.celsius : today.high.fahrenheit,
                        low: useCelsius ? today.low.celsius : today.low.fahrenheit,
                        icon: today.icon
                    },
                    tomorrow: {
                        day: tomorrow.date.weekday,
                        conditions: tomorrow.conditions,
                        high: useCelsius ? tomorrow.high.celsius : tomorrow.high.fahrenheit,
                        low: useCelsius ? tomorrow.low.celsius : tomorrow.low.fahrenheit,
                        icon: tomorrow.icon
                    }
                });
            }).catch(function(error) {
                console.error('Could not determine weather, falling back to dummy data.');
                callback({
                    today: {
                        day: 'Someday',
                        conditions: 'Thunderstorms',
                        high: useCelsius ? '100' : '212',
                        low: useCelsius ? '0' : '32',
                        icon: 'tstorms'
                    },
                    tomorrow: {
                        day: 'Someday',
                        conditions: 'Clear',
                        high: useCelsius ? '21' : '7',
                        low: useCelsius ? '18' : '6',
                        icon: 'sunny'
                    }
                });
            });
    }

    function updateWeather() {
        var useCelsius = false;
        getForecast(useCelsius, function(forecast) {
            ['today', 'tomorrow'].forEach(function(day) {
                var forecastDay = document.getElementById(day);
                var icon = forecastDay.getElementsByClassName('forecastIcon')[0];
                icon.src = 'icons/' + forecast[day].icon + '.svg';
                var high = forecastDay.getElementsByClassName('forecastHighTemp')[0];
                high.innerText = forecast[day].high;
                var low = forecastDay.getElementsByClassName('forecastLowTemp')[0];
                low.innerText = forecast[day].low;
                var conditions = forecastDay.getElementsByClassName('forecastConditions')[0];
                conditions.innerText = forecast[day].day + ': ' + forecast[day].conditions;
            });
        });
    }

    window.setInterval(updateDateTime, 1000); // Update date&time once per second (1000ms).
    updateDateTime(); // Immediately update once so the date&time is correct for the first frame.
    window.setInterval(updateWeather, 14400000); // Update weather every 4 hours (4*60*60*1000ms).
    updateWeather(); // Immediately update once so the weather is correct for the first frame.
</script>
