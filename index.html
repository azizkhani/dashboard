<!DOCTYPE HTML>
<meta name="viewport" content="width=device-width">
<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Roboto:300" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Roboto:500" rel="stylesheet">
<style>
    html {
        text-align: right;
        font-family: 'Roboto', sans-serif;
        font-size: 8vmin;
        font-style: normal;
        font-weight: 300;
        color: white;
        background: black;
        -webkit-font-smoothing: subpixel-antialiased;
    }
    #dayOfMonthOrdinal {
        font-size: 5vmin;
        vertical-align: super;
    }
    .time {
        font-weight: 500;
        font-size: 30vmin;
    }
    .temperature {
        padding-top: 10vmin;
        text-align: right;
        float: right;
    }
    .temperatureLabel {
        padding-right: 5vmin;
    }
    .weather {
        padding-top: 10vmin;

        /* The Wunderground API requires an attribution image. */
        /* https://www.wunderground.com/weather/api/d/terms.html */
        background-image: url('wundergroundLogo.png');
        background-position: bottom right;
        background-repeat: no-repeat;
        background-size: 90px auto;
        padding-bottom: 23px;
    }
    .forecastIcon {
        width: 15vmin;
        height: 15vmin;
        padding: 1vmin;
    }
    .forecastData {
        float: right;
    }
    .forecastDay {
        font-size: 3.3vmin;
    }
    .forecastHigh {
        font-size: 5vmin;
    }
    .forecastLow {
        font-size: 5vmin;
    }
</style>
<div class="date">
    <span id="day">Saturday</span>, <span id="month">Sep</span> <span id="dayOfMonth">10</span><span id="dayOfMonthOrdinal">st</span>
</div>
<div class="time">
    <span id="hour">5</span><span id="timeColon">:</span><span id="minute">21</span>
</div>
<div class="weather">
    <div id="today" class="forecast">
        <img id="forecastTodayIcon" class="forecastIcon">
        <div class="forecastData">
            <div id="forecastTodayDay" class="forecastDay"></div>
            <div class="forecastHigh">
                <span id="forecastTodayHigh"></span>&deg;<span class="weatherUnit">F</span>
            </div>
            <div class="forecastLow">
                <span id="forecastTodayLow"></span>&deg;<span class="weatherUnit">F</span>
            </div>
        </div>
    </div>
    <div id="tomorrow" class="forecast">
        <img id="forecastTomorrowIcon" class="forecastIcon">
        <div class="forecastData">
            <div id="forecastTomorrowDay" class="forecastDay"></div>
            <div class="forecastHigh">
                <span id="forecastTomorrowHigh"></span>&deg;<span class="weatherUnit">F</span>
            </div>
            <div class="forecastLow">
                <span id="forecastTomorrowLow"></span>&deg;<span class="weatherUnit">F</span>
            </div>
        </div>
    </div>
</div>
<script>
    var weekdays = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    function dayOfWeekName(date) {
        return weekdays[date.getDay()];
    }

    var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sept', 'Oct', 'Nov', 'Dec'];
    function monthName(date) {
        return months[date.getMonth()];
    }

    // Credit for this ordinal code:
    // https://ecommerce.shopify.com/c/ecommerce-design/t/ordinal-number-in-javascript-1st-2nd-3rd-4th-29259
    var ordinals = ['th', 'st', 'nd', 'rd'];
    function ordinal(number) {
        var v = number % 100;
        return ordinals[(v-20)%10] || ordinals[v] || ordinals[0];
    }

    function updateDateTime() {
        var date = new Date();

        day.innerText = dayOfWeekName(date);
        month.innerText = monthName(date);
        dayOfMonth.innerText = date.getDate();
        dayOfMonthOrdinal.innerText = ordinal(date.getDate());

        hour.innerText = date.getHours();
        // Make the colon white on even seconds, black on odd seconds.
        var colonVisible = date.getSeconds() % 2 === 0;
        timeColon.style.color = colonVisible ? 'white' : 'black';
        minute.innerText = (date.getMinutes() < 10 ? '0' : '') + date.getMinutes();
    }

    function getForecast(callback) {
        // API key from https://www.wunderground.com/weather/api
        var apiKey = 'do_not_use_18dc12c420cff7c6';
        var forecastUrl = 'http://api.wunderground.com/api/' + apiKey + '/forecast/q/autoip.json';
        var forecastRequest = new Request(forecastUrl);
        fetch(forecastRequest)
            .then(function(response) {
                return response.json();
            }).then(function(json) {
                var today = json.forecast.simpleforecast.forecastday[0];
                var tomorrow = json.forecast.simpleforecast.forecastday[1];
                callback({
                    today: {
                        day: today.date.weekday,
                        high: useCelsius ? today.high.celsius : today.high.fahrenheit,
                        low: useCelsius ? today.low.celsius : today.low.fahrenheit,
                        icon: today.icon
                    },
                    tomorrow: {
                        day: tomorrow.date.weekday,
                        high: useCelsius ? tomorrow.high.celsius : tomorrow.high.fahrenheit,
                        low: useCelsius ? tomorrow.low.celsius : tomorrow.low.fahrenheit,
                        icon: tomorrow.icon
                    }
                });
            }).catch(function(error) {
                console.error('Could not determine weather, falling back to dummy data.');
                callback({
                    today: {
                        day: 'Someday',
                        high: useCelsius ? '100' : '212',
                        low: useCelsius ? '0' : '32',
                        icon: 'tstorms'
                    },
                    tomorrow: {
                        day: 'Someday',
                        high: useCelsius ? '21' : '70',
                        low: useCelsius ? '18' : '65',
                        icon: 'cloudy'
                    }
                });
            });
    }

    function updateWeather() {
        getForecast(function(forecast) {
            forecastTodayIcon.src = 'http://icons.wxug.com/i/c/k/' + forecast.today.icon + '.gif';
            forecastTodayDay.innerText = forecast.today.day;
            forecastTodayHigh.innerText = forecast.today.high;
            forecastTodayLow.innerText = forecast.today.low;
            forecastTomorrowIcon.src = 'http://icons.wxug.com/i/c/k/' + forecast.tomorrow.icon + '.gif';
            forecastTomorrowDay.innerText = forecast.tomorrow.day;
            forecastTomorrowHigh.innerText = forecast.tomorrow.high;
            forecastTomorrowLow.innerText = forecast.tomorrow.low;

            var unitElements = document.getElementsByClassName('weatherUnit');
            for (var unitElement in unitElements)
                unitElements[unitElement].innerText = useCelsius ? 'C' : 'F';
        });
    }

    var useCelsius = false;
    window.setInterval(updateDateTime, 1000); // Update date&time once per second (1000ms).
    updateDateTime(); // Immediately update once so the date&time is correct for the first frame.
    window.setInterval(updateWeather, 14400000); // Update weather every 4 hours (4*60*60*1000ms).
    updateWeather(); // Immediately update once so the weather is correct for the first frame.
</script>
